trigger:
- master

pool:
  name: Default
  
variables:
  system.debug: true
  
steps:
- bash: |
    # Localise le node interne dans le dossier de l'agent
    INTERNAL_NODE=$(find $AGENT_HOMEDIRECTORY/externals -name node -type f | head -n 1)
    echo "Le Node interne de l'agent est : $INTERNAL_NODE"
    $INTERNAL_NODE -v
  displayName: 'VÃ©rification Node Interne Agent'

- task: NodeTool@0
  inputs:
    versionSpec: '12.x'

- script: |
    echo "VERSION UTILISEE POUR LE TEST :"
    node -v
  displayName: 'Check Node Version before JFrog'
  
- powershell: |
    # On force la variable que l'agent utilise parfois pour localiser Node
    Write-Host "##vso[task.setvariable variable=AGENT_NODE_PATH]$(which node)"
  displayName: 'Force Agent to use Node 12'

- task: JfrogCliV2@1
  inputs:
    jfrogPlatformConnection: 'elinaf-platform'
    command: 'jf rt dl example-repo-local/crowdstrike.6.39.15316.0.nupkg --build-name=davidfa-azure --build-number=1'
- task: JFrogPublishBuildInfo@1
  inputs:
    artifactoryConnection: 'elinaf-artv2'
    buildName: 'davidfa-azure'
    buildNumber: '1'

